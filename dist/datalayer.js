"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function a(s,o,f){function c(t,e){if(!o[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(g)return g(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=o[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,a,s,o,f)}return o[t].exports}for(var g="function"==typeof require&&require,e=0;e<f.length;e++)c(f[e]);return c}({1:[function(e,t,n){var s={};s.Item=e("./DataLayerItem"),s.utils=e("./DataLayerUtils");var a="datalayer:change",o="datalayer:event",r="datalayer:ready",i="past",f="future",c="all";s.Manager=function(e){this._config=e,this._initialize()},s.Manager.prototype._initialize=function(){var e=this;Array.isArray(e._config.dataLayer)||(e._config.dataLayer=[]),e._dataLayer=e._config.dataLayer,e._state={},e._listeners={},e._augment(),e._processItems();var t=new s.Item({event:r});e._triggerListeners(t)},s.Manager.prototype._augment=function(){var a=this;a._dataLayer.push=function(e){var r=arguments,i=arguments;if(Object.keys(r).forEach(function(e){var t=r[e],n=new s.Item(t);a._processItem(n),!s.utils.isListenerConfig(t)&&n.valid||delete i[e]}),i[0])return Array.prototype.push.apply(this,i)},a._dataLayer.getState=function(){return JSON.parse(JSON.stringify(a._state))}},s.Manager.prototype._processItems=function(){for(var e=this,t=0;t<e._dataLayer.length;t++){var n=new s.Item(e._dataLayer[t],t);e._processItem(n),!s.utils.isListenerConfig(n.config)&&n.valid||(e._dataLayer.splice(t,1),t--)}},s.Manager.prototype._processItem=function(e){var t=this;if(e.valid){({data:function(e){t._updateState(e),t._triggerListeners(e)},event:function(e){e.config.data&&t._updateState(e),t._triggerListeners(e)},listenerOn:function(e){t._processListenerOn(e)},listenerOff:function(e){t._unregisterListener(e)}})[e.type](e)}else{var n="The following item cannot be handled by the data layer because it does not have a valid format: "+JSON.stringify(e.config);console.error(n)}},s.Manager.prototype._processListenerOn=function(e){var t=e.config.scope;switch(t=t||f){case i:this._triggerListener(e);break;case f:this._registerListener(e);break;case c:this._triggerListener(e),this._registerListener(e);break;default:console.error("The listener does not have a valid scope: "+t)}},s.Manager.prototype._triggerListener=function(e){var t=e.index;if(!(0===t||0===this._dataLayer.length||t>this._dataLayer.length-1))for(var n=t&&-1!==t?t:this._dataLayer.length,r=0;r<n;r++){var i=this._dataLayer[r],a=new s.Item(i,r);this._callListenerHandler(e,a)}},s.Manager.prototype._triggerListeners=function(t){var n=this;n._getTriggeredEvents(t).forEach(function(e){n._listeners[e]&&n._listeners[e].forEach(function(e){n._callListenerHandler(e,t)})})},s.Manager.prototype._callListenerHandler=function(e,t){if(this._isMatching(e,t)){var n=e.config,r=t.config,i=JSON.parse(JSON.stringify(r));n.handler(i)}},s.Manager.prototype._isMatching=function(e,t){if(!e||!t)return!1;var n=e.config,r=t.config,i=!1;return s.utils.isDataConfig(r)?n.on===a&&(i=!0):s.utils.isEventConfig(r)&&(n.on!==o&&n.on!==r.event||(i=!0),r.data&&n.on===a&&(i=!0)),i},s.Manager.prototype._getTriggeredEvents=function(e){if(!e)return[];var t=[],n=e.config;return s.utils.isDataConfig(n)?t.push(a):s.utils.isEventConfig(n)&&(t.push(n.event),t.push(o),n.data&&t.push(a)),t},s.Manager.prototype._registerListener=function(e){var t=e.config,n=t.on;0===this._getRegisteredListeners(t).length&&(this._listeners[n]||(this._listeners[n]=[]),this._listeners[n].push(e),console.debug("listener registered on: ",n))},s.Manager.prototype._unregisterListener=function(e){var t=e.config,n=t.off,r=JSON.parse(JSON.stringify(t));r.on=n,r.handler=t.handler,delete r.off;for(var i=this._getRegisteredListeners(r),a=0;a<i.length;a++)-1<i[a]&&(this._listeners[n].splice(i[a],1),console.debug("listener unregistered on: ",n))},s.Manager.prototype._updateState=function(e){s.utils.deepMerge(this._state,e.config.data)},s.Manager.prototype._getRegisteredListeners=function(e){var t=[],n=e.on;if(this._listeners[n])for(var r=0;r<this._listeners[n].length;r++){var i=this._listeners[n][r].config;if(n===i.on){if(e.handler&&e.handler.toString()!==i.handler.toString())continue;t.push(r)}}return t},new s.Manager({dataLayer:window.dataLayer}),t.exports=s},{"./DataLayerItem":2,"./DataLayerUtils":3}],2:[function(e,t,n){var s=e("./DataLayerUtils"),o="data",f="event",c="listenerOn",g="listenerOff",r=function(){function a(e,t){_classCallCheck(this,a);var n,r,i=this;i._config=e,i._type=(n=e,s.isDataConfig(n)?r=o:s.isEventConfig(n)?r=f:s.isListenerOnConfig(n)?r=c:s.isListenerOffConfig(n)&&(r=g),r),i._index=t,i._valid=!!i._type}return _createClass(a,[{key:"config",get:function(){return this._config}},{key:"type",get:function(){return this._type}},{key:"valid",get:function(){return this._valid}},{key:"index",get:function(){return this._index}}]),a}();t.exports=r},{"./DataLayerUtils":3}],3:[function(e,t,n){var r={deepMerge:function(t,n){var r={},i=this;i.isObject(t)&&i.isObject(n)&&Object.keys(n).forEach(function(e){i.isObject(n[e])?(t[e]||(r[e]={},Object.assign(t,r)),i.deepMerge(t[e],n[e])):void 0===n[e]?delete t[e]:(r[e]=n[e],Object.assign(t,r))})},isObject:function(e){return e&&"object"===_typeof(e)&&!Array.isArray(e)},isDataConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.data)},isEventConfig:function(e){if(!e)return!1;var t=Object.keys(e);return 1===t.length&&e.event||2===t.length&&e.event&&(e.info||e.data)||3===t.length&&e.event&&e.info&&e.data},isListenerConfig:function(e){return this.isListenerOnConfig(e)||this.isListenerOffConfig(e)},isListenerOnConfig:function(e){if(!e)return!1;var t=Object.keys(e);return 2===t.length&&e.on&&e.handler||3===t.length&&e.on&&e.handler&&(e.scope||e.selector)||4===t.length&&e.on&&e.handler&&e.scope&&e.selector},isListenerOffConfig:function(e){if(!e)return!1;var t=Object.keys(e);return 1===t.length&&e.off||2===t.length&&e.off&&e.handler||3===t.length&&e.off&&e.handler&&(e.scope||e.selector)||4===t.length&&e.off&&e.handler&&e.scope&&e.selector}};t.exports=r},{}]},{},[1]);
//# sourceMappingURL=datalayer.js.map

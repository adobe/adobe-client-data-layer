!function(){"use strict";var a={},i="datalayer:change",n="datalayer:event",r="datalayer:ready";a.Manager=function(e){this._config=e,this._initialize()},a.Manager.prototype._initialize=function(){var e=this;Array.isArray(e._config.dataLayer)||(e._config.dataLayer=[]),e._dataLayer=e._config.dataLayer,e._state={},e._listeners=[],e._augment(),e._processItems(),e._triggerListeners({event:r},r)},a.Manager.prototype._augment=function(){var s=this;s._dataLayer.push=function(e){var i=arguments,r=arguments;if(Object.keys(i).forEach(function(e){var t=i[e],n=new a.Item(t);s._processItem(n),n.utils.isListenerConfig(n.getConfig())&&delete r[e]}),r[0])return Array.prototype.push.apply(this,r)},s._dataLayer.getState=function(){return JSON.parse(JSON.stringify(s._state))}},a.Manager.prototype._processItems=function(){for(var e=this,t=0;t<e._dataLayer.length;t++){var n=new a.Item(e._dataLayer[t]);e._processItem(n),n.utils.isListenerConfig(n.getConfig())&&(e._dataLayer.splice(t,1),t--)}},a.Manager.prototype._processItem=function(e){var t=this;if(e.isValid()){({data:function(e){t._updateState(e),t._triggerListeners(e.getConfig(),i)},event:function(e){t._triggerListeners(e),e.getConfig().data&&(t._updateState(e),t._triggerListeners(e.getConfig(),i))},listenerOn:function(e){t._registerListener(e.getConfig())},listenerOff:function(e){t._unregisterListener(e.getConfig())}})[e.getType()](e)}else{var n="The following item cannot be handled by the data layer because it does not have a valid format: "+JSON.stringify(e);console.error(n)}},a.Manager.prototype._updateState=function(e){a.utils.deepMerge(this.state,e.data)},a.Manager.prototype._triggerListeners=function(n,i){console.debug("event triggered -",i),this._listeners.forEach(function(e){if(e.on===i||e.on===n.event){var t=JSON.parse(JSON.stringify(n));n.event&&(t.name=n.event),e.handler(t)}})},a.Manager.prototype._triggerListener=function(t){this.dataLayer.forEach(function(e){t.on!==r&&t.on!==i&&t.on!==n&&t.on!==e.event||t.handler(e)})},a.Manager.prototype._registerListener=function(e){0===this._getListenerIndexes(e).length&&(this._listeners.push(e),console.debug("listener registered on -",e.on))},a.Manager.prototype._unregisterListener=function(e){var t=JSON.parse(JSON.stringify(e));t.on=e.off,delete t.off;for(var n=this._getListenerIndexes(t),i=0;i<n.length;i++)-1<n[i]&&(this._listeners.splice(n[i],1),console.debug("listener unregistered on -",t.on))},a.Manager.prototype._getListenerIndexes=function(e){for(var t=[],n=0;n<this._listeners.length;n++){var i=this._listeners[n];if(e.on!==i.on);else{if(e.handler&&e.handler.toString()!==i.handler.toString())continue;t.push(n)}}return t};var s="data",o="event",g="listenerOn",f="listenerOff";a.Item=function(e){var t,n,i=this;i._config=e,i._type=(t=e,i.utils.isDataConfig(t)?n=s:i.utils.isEventConfig(t)?n=o:i.utils.isListenerOnConfig(t)?n=g:i.utils.isListenerOffConfig(t)&&(n=f),n),i._valid=!!i._type},a.Item.prototype.isValid=function(){return this._valid},a.Item.prototype.getType=function(){return this._type},a.Item.prototype.getConfig=function(){return this._config},a.Item.prototype.utils={isDataConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.data)},isEventConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.event||2===Object.keys(e).length&&e.event&&e.info||2===Object.keys(e).length&&e.event&&e.data||3===Object.keys(e).length&&e.event&&e.info&&e.data)},isListenerConfig:function(e){return this.isListenerOnConfig(e)||this.isListenerOffConfig(e)},isListenerOnConfig:function(e){return!!e&&(2===Object.keys(e).length&&e.on&&e.handler||3===Object.keys(e).length&&e.on&&e.handler&&e.scope||3===Object.keys(e).length&&e.on&&e.handler&&e.selector||4===Object.keys(e).length&&e.on&&e.handler&&e.scope&&e.selector)},isListenerOffConfig:function(e){return!!e&&(1===Object.keys(e).length&&e.off||2===Object.keys(e).length&&e.off&&e.handler||3===Object.keys(e).length&&e.off&&e.handler&&e.scope||3===Object.keys(e).length&&e.off&&e.handler&&e.selector||4===Object.keys(e).length&&e.off&&e.handler&&e.scope&&e.selector)}},a.utils={},a.utils.deepMerge=function(t,n){var i={},r=this;r.isObject(t)&&r.isObject(n)&&Object.keys(n).forEach(function(e){r.isObject(n[e])?(t[e]||(i[e]={},Object.assign(t,i)),r.deepMerge(t[e],n[e])):void 0===n[e]?delete t[e]:(i[e]=n[e],Object.assign(t,i))})},a.utils.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)},new a.Manager({dataLayer:window.dataLayer})}();